{"ast":null,"code":"import { openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-333fd7da\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"login-container\"\n};\nconst _hoisted_2 = {\n  class: \"Auth-form\"\n};\nconst _hoisted_3 = {\n  key: 0,\n  class: \"alert alert-danger\",\n  role: \"alert\"\n};\nconst _hoisted_4 = {\n  class: \"Auth-form-content\"\n};\nconst _hoisted_5 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"h3\", {\n  class: \"Auth-form-title\"\n}, \"Đăng nhập\", -1 /* HOISTED */));\nconst _hoisted_6 = {\n  class: \"form-group mt-3\"\n};\nconst _hoisted_7 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"label\", null, \"Tài khoản\", -1 /* HOISTED */));\nconst _hoisted_8 = {\n  class: \"form-group mt-3\"\n};\nconst _hoisted_9 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"label\", null, \"Mật khẩu\", -1 /* HOISTED */));\nconst _hoisted_10 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"div\", {\n  class: \"d-grid gap-2 mt-3\"\n}, [/*#__PURE__*/_createElementVNode(\"button\", {\n  type: \"submit\",\n  class: \"btn btn-primary\"\n}, \"Đăng nhập\")], -1 /* HOISTED */));\nconst _hoisted_11 = {\n  key: 0\n};\nconst _hoisted_12 = {\n  class: \"login text-right mt-2\"\n};\nconst _hoisted_13 = {\n  class: \"forgot-password\"\n};\nconst _hoisted_14 = {\n  class: \"register-link\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_router_link = _resolveComponent(\"router-link\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"form\", {\n    onSubmit: _cache[2] || (_cache[2] = (...args) => $setup.login && $setup.login(...args)),\n    class: \"Auth-form-container\"\n  }, [_createElementVNode(\"div\", _hoisted_2, [$setup.err ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, \" Tên người dùng hoặc mật khẩu không chính xác. Vui lòng thử lại. \")) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", _hoisted_4, [_hoisted_5, _createElementVNode(\"div\", _hoisted_6, [_hoisted_7, _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.username = $event),\n    required: \"\",\n    type: \"text\",\n    class: \"form-control mt-1\",\n    placeholder: \"Nhập tài khoản\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.username]])]), _createElementVNode(\"div\", _hoisted_8, [_hoisted_9, _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.password = $event),\n    required: \"\",\n    type: \"password\",\n    class: \"form-control mt-1\",\n    placeholder: \"Nhập mật khẩu\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.password]])]), _hoisted_10, $setup.err ? (_openBlock(), _createElementBlock(\"span\", _hoisted_11, \"Something went wrong\")) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", _hoisted_12, [_createElementVNode(\"div\", _hoisted_13, [_createTextVNode(\" Quên \"), _createVNode(_component_router_link, {\n    to: \"#\"\n  }, {\n    default: _withCtx(() => [_createTextVNode(\"mật khẩu?\")]),\n    _: 1 /* STABLE */\n  })]), _createElementVNode(\"div\", _hoisted_14, [_createVNode(_component_router_link, {\n    to: \"/register\"\n  }, {\n    default: _withCtx(() => [_createTextVNode(\"Đăng ký\")]),\n    _: 1 /* STABLE */\n  })])])])])], 32 /* HYDRATE_EVENTS */)]);\n}","map":{"version":3,"names":["class","role","_createElementVNode","type","_createElementBlock","_hoisted_1","onSubmit","_cache","args","$setup","login","_hoisted_2","err","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","username","$event","required","placeholder","_hoisted_8","_hoisted_9","password","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_createVNode","_component_router_link","to","_hoisted_14"],"sources":["D:\\university\\src\\layouts\\login.vue"],"sourcesContent":["<template>\r\n  <div class=\"login-container\">\r\n    <form @submit=\"login\" class=\"Auth-form-container\">\r\n      <div class=\"Auth-form\">\r\n        <template v-if=\"err\">\r\n          <div class=\"alert alert-danger\" role=\"alert\">\r\n            Tên người dùng hoặc mật khẩu không chính xác. Vui lòng thử lại.\r\n          </div>\r\n        </template>\r\n        <div class=\"Auth-form-content\">\r\n          <h3 class=\"Auth-form-title\">Đăng nhập</h3>\r\n          <div class=\"form-group mt-3\">\r\n            <label>Tài khoản</label>\r\n            <input\r\n              v-model=\"username\"\r\n              required\r\n              type=\"text\"\r\n              class=\"form-control mt-1\"\r\n              placeholder=\"Nhập tài khoản\"\r\n            />\r\n          </div>\r\n          <div class=\"form-group mt-3\">\r\n            <label>Mật khẩu</label>\r\n            <input\r\n              v-model=\"password\"\r\n              required\r\n              type=\"password\"\r\n              class=\"form-control mt-1\"\r\n              placeholder=\"Nhập mật khẩu\"\r\n            />\r\n          </div>\r\n          <div class=\"d-grid gap-2 mt-3\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Đăng nhập</button>\r\n          </div>\r\n          <template v-if=\"err\">\r\n            <span>Something went wrong</span>\r\n          </template>\r\n          <div class=\"login text-right mt-2\">\r\n            <div class=\"forgot-password\">\r\n              Quên <router-link to=\"#\">mật khẩu?</router-link>\r\n            </div>\r\n            <div class=\"register-link\">\r\n              <router-link to=\"/register\">Đăng ký</router-link>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref } from 'vue';\r\nimport { useNavigate } from 'vue-router';\r\nimport Apis, { authApi, endpoints } from '../';\r\nimport { auth } from \"../../firebase\";\r\nimport { signInWithEmailAndPassword } from \"firebase/auth\";\r\nimport cookie from \"vue-cookies\";\r\n\r\nexport default {\r\n  setup() {\r\n    const username = ref('');\r\n    const password = ref('');\r\n    const err = ref(false);\r\n    const navigate = useNavigate();\r\n\r\n    const login = async (evt) => {\r\n      evt.preventDefault();\r\n\r\n      const process = async () => {\r\n        try {\r\n          let res = await Apis.post(endpoints['login'], {\r\n            \"username\": username.value,\r\n            \"password\": password.value\r\n          });\r\n          cookie.set(\"token\", res.data);\r\n\r\n          let { data } = await authApi().get(endpoints['current-user']);\r\n          cookie.set(\"user\", data);\r\n\r\n          // dispatch({\r\n          //   \"type\": \"login\",\r\n          //   \"payload\": data\r\n          // });\r\n\r\n          try {\r\n            const u = await getUserByUsername(username.value);\r\n            if (u) {\r\n              const studentUsername = u.username;\r\n\r\n              // Fetch student information\r\n              const studentInfo = await authApi().get(endpoints['get-student-by-username'].replace(\"{username}\", studentUsername));\r\n\r\n              const userEmail = u.email; // Lấy email của người dùng\r\n              await signInWithEmailAndPassword(auth, userEmail, password.value);\r\n              navigate(\"/\")\r\n            } else {\r\n              console.log('User not found');\r\n              err.value = true;\r\n            }\r\n\r\n          } catch (err) {\r\n            err.value = true;\r\n          }\r\n        } catch (err) {\r\n          console.error(err);\r\n          err.value = true;\r\n        }\r\n      }\r\n\r\n      process();\r\n    }\r\n\r\n    const getUserByUsername = async (username) => {\r\n      try {\r\n        const response = await Apis.get(endpoints[\"get-user\"].replace(\"{username}\", username));\r\n        return response.data;\r\n      } catch (error) {\r\n        console.error(error);\r\n        return null;\r\n      }\r\n    }\r\n\r\n    return {\r\n      username,\r\n      password,\r\n      err,\r\n      login\r\n    };\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n/* Thêm CSS của bạn tại đây */\r\n</style>\r\n"],"mappings":";;;EACOA,KAAK,EAAC;AAAiB;;EAEnBA,KAAK,EAAC;AAAW;;;EAEbA,KAAK,EAAC,oBAAoB;EAACC,IAAI,EAAC;;;EAIlCD,KAAK,EAAC;AAAmB;gEAC5BE,mBAAA,CAA0C;EAAtCF,KAAK,EAAC;AAAiB,GAAC,WAAS;;EAChCA,KAAK,EAAC;AAAiB;gEAC1BE,mBAAA,CAAwB,eAAjB,WAAS;;EASbF,KAAK,EAAC;AAAiB;gEAC1BE,mBAAA,CAAuB,eAAhB,UAAQ;iEASjBA,mBAAA,CAEM;EAFDF,KAAK,EAAC;AAAmB,I,aAC5BE,mBAAA,CAAgE;EAAxDC,IAAI,EAAC,QAAQ;EAACH,KAAK,EAAC;GAAkB,WAAS,E;;;;;EAKpDA,KAAK,EAAC;AAAuB;;EAC3BA,KAAK,EAAC;AAAiB;;EAGvBA,KAAK,EAAC;AAAe;;;uBAxCpCI,mBAAA,CA+CM,OA/CNC,UA+CM,GA9CJH,mBAAA,CA6CO;IA7CAI,QAAM,EAAAC,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAEC,MAAA,CAAAC,KAAA,IAAAD,MAAA,CAAAC,KAAA,IAAAF,IAAA,CAAK;IAAER,KAAK,EAAC;MAC1BE,mBAAA,CA2CM,OA3CNS,UA2CM,GA1CYF,MAAA,CAAAG,GAAG,I,cACjBR,mBAAA,CAEM,OAFNS,UAEM,EAFuC,mEAE7C,K,mCAEFX,mBAAA,CAoCM,OApCNY,UAoCM,GAnCJC,UAA0C,EAC1Cb,mBAAA,CASM,OATNc,UASM,GARJC,UAAwB,E,gBACxBf,mBAAA,CAME;+DALSO,MAAA,CAAAS,QAAQ,GAAAC,MAAA;IACjBC,QAAQ,EAAR,EAAQ;IACRjB,IAAI,EAAC,MAAM;IACXH,KAAK,EAAC,mBAAmB;IACzBqB,WAAW,EAAC;iDAJHZ,MAAA,CAAAS,QAAQ,E,KAOrBhB,mBAAA,CASM,OATNoB,UASM,GARJC,UAAuB,E,gBACvBrB,mBAAA,CAME;+DALSO,MAAA,CAAAe,QAAQ,GAAAL,MAAA;IACjBC,QAAQ,EAAR,EAAQ;IACRjB,IAAI,EAAC,UAAU;IACfH,KAAK,EAAC,mBAAmB;IACzBqB,WAAW,EAAC;iDAJHZ,MAAA,CAAAe,QAAQ,E,KAOrBC,WAEM,EACUhB,MAAA,CAAAG,GAAG,I,cACjBR,mBAAA,CAAiC,QAAAsB,WAAA,EAA3B,sBAAoB,K,mCAE5BxB,mBAAA,CAOM,OAPNyB,WAOM,GANJzB,mBAAA,CAEM,OAFN0B,WAEM,G,iBAFuB,QACtB,GAAAC,YAAA,CAA2CC,sBAAA;IAA9BC,EAAE,EAAC;EAAG;sBAAC,MAAS,C,iBAAT,WAAS,E;;QAEpC7B,mBAAA,CAEM,OAFN8B,WAEM,GADJH,YAAA,CAAiDC,sBAAA;IAApCC,EAAE,EAAC;EAAW;sBAAC,MAAO,C,iBAAP,SAAO,E"},"metadata":{},"sourceType":"module","externalDependencies":[]}