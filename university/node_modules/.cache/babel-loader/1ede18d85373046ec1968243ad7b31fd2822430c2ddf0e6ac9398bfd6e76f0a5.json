{"ast":null,"code":"import { openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, withModifiers as _withModifiers, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-333fd7da\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"Auth-form\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"alert alert-danger\"\n};\nconst _hoisted_3 = {\n  class: \"Auth-form-content\"\n};\nconst _hoisted_4 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"h3\", {\n  class: \"Auth-form-title\"\n}, \"Đăng nhập\", -1 /* HOISTED */));\nconst _hoisted_5 = {\n  class: \"form-group mt-3\"\n};\nconst _hoisted_6 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"label\", null, \"Tài khoản\", -1 /* HOISTED */));\nconst _hoisted_7 = {\n  class: \"form-group mt-3\"\n};\nconst _hoisted_8 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"label\", null, \"Mật khẩu\", -1 /* HOISTED */));\nconst _hoisted_9 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"div\", {\n  class: \"d-grid gap-2 mt-3\"\n}, [/*#__PURE__*/_createElementVNode(\"button\", {\n  type: \"submit\",\n  class: \"btn btn-primary\"\n}, \"Đăng nhập\")], -1 /* HOISTED */));\nconst _hoisted_10 = {\n  class: \"login text-right mt-2\"\n};\nconst _hoisted_11 = {\n  class: \"forgot-password\"\n};\nconst _hoisted_12 = {\n  class: \"register-link\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_router_link = _resolveComponent(\"router-link\");\n  return _openBlock(), _createElementBlock(\"div\", null, [_createElementVNode(\"form\", {\n    onSubmit: _cache[2] || (_cache[2] = _withModifiers((...args) => $setup.login && $setup.login(...args), [\"prevent\"])),\n    class: \"Auth-form-container\"\n  }, [_createElementVNode(\"div\", _hoisted_1, [$setup.err ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, \" Tên người dùng hoặc mật khẩu không chính xác. Vui lòng thử lại. \")) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", _hoisted_3, [_hoisted_4, _createElementVNode(\"div\", _hoisted_5, [_hoisted_6, _withDirectives(_createElementVNode(\"input\", {\n    required: \"\",\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.username = $event),\n    type: \"text\",\n    class: \"form-control mt-1\",\n    placeholder: \"Nhập tài khoản\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.username]])]), _createElementVNode(\"div\", _hoisted_7, [_hoisted_8, _withDirectives(_createElementVNode(\"input\", {\n    required: \"\",\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.password = $event),\n    type: \"password\",\n    class: \"form-control mt-1\",\n    placeholder: \"Nhập mật khẩu\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.password]])]), _hoisted_9, _createElementVNode(\"div\", _hoisted_10, [_createElementVNode(\"div\", _hoisted_11, [_createTextVNode(\" Quên \"), _createVNode(_component_router_link, {\n    to: \"#\"\n  }, {\n    default: _withCtx(() => [_createTextVNode(\"mật khẩu?\")]),\n    _: 1 /* STABLE */\n  })]), _createElementVNode(\"div\", _hoisted_12, [_createVNode(_component_router_link, {\n    to: \"/register\"\n  }, {\n    default: _withCtx(() => [_createTextVNode(\"Đăng ký\")]),\n    _: 1 /* STABLE */\n  })])])])])], 32 /* HYDRATE_EVENTS */)]);\n}","map":{"version":3,"names":["class","_createElementVNode","type","_createElementBlock","onSubmit","_cache","_withModifiers","args","$setup","login","_hoisted_1","err","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","required","username","$event","placeholder","_hoisted_7","_hoisted_8","password","_hoisted_9","_hoisted_10","_hoisted_11","_createVNode","_component_router_link","to","_hoisted_12"],"sources":["D:\\university\\src\\layouts\\login.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <form @submit.prevent=\"login\" class=\"Auth-form-container\">\r\n            <div class=\"Auth-form\">\r\n                <div v-if=\"err\" class=\"alert alert-danger\">\r\n                    Tên người dùng hoặc mật khẩu không chính xác. Vui lòng thử lại.\r\n                </div>\r\n                <div class=\"Auth-form-content\">\r\n                    <h3 class=\"Auth-form-title\">Đăng nhập</h3>\r\n                    <div class=\"form-group mt-3\">\r\n                        <label>Tài khoản</label>\r\n                        <input required v-model=\"username\" type=\"text\" class=\"form-control mt-1\"\r\n                            placeholder=\"Nhập tài khoản\" />\r\n                    </div>\r\n                    <div class=\"form-group mt-3\">\r\n                        <label>Mật khẩu</label>\r\n                        <input required v-model=\"password\" type=\"password\" class=\"form-control mt-1\"\r\n                            placeholder=\"Nhập mật khẩu\" />\r\n                    </div>\r\n                    <div class=\"d-grid gap-2 mt-3\">\r\n                        <button type=\"submit\" class=\"btn btn-primary\">Đăng nhập</button>\r\n                    </div>\r\n                    <div class=\"login text-right mt-2\">\r\n                        <div class=\"forgot-password\">\r\n                            Quên <router-link to=\"#\">mật khẩu?</router-link>\r\n                        </div>\r\n                        <div class=\"register-link\">\r\n                            <router-link to=\"/register\">Đăng ký</router-link>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </form>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import { ref } from 'vue';\r\n    import { useRouter } from 'vue-router';\r\n    import Apis, { endpoints, authApi } from '../configs/Apis.js';\r\n    import VueCookies from 'vue-cookies';\r\n    import { login } from '../reducers/myUseReducer.js';\r\n    import axios from 'axios';\r\n\r\n    export default {\r\n        setup() {\r\n            const username = ref('');\r\n            const password = ref('');\r\n            const err = ref(false);\r\n            const router = useRouter();\r\n            const token = ref(null);\r\n            const user = ref(null);\r\n            let hasLoggedIn = false;\r\n\r\n            const login = async () => {\r\n                try {\r\n                    if (hasLoggedIn) {\r\n                    let res = await Apis.post(endpoints.login, {\r\n                        username: username.value,\r\n                        password: password.value\r\n                    });\r\n                    console.log(res);\r\n                    // Lưu token vào cookie tại đây nếu cần\r\n                    VueCookies.set('token', res.data);\r\n\r\n                    let { data } = await authApi().get(endpoints['current-user']);\r\n                    console.log(\"curent user\", data);\r\n                    // Lưu thông tin người dùng vào cookie tại đây nếu cần\r\n                    // Hàm để lưu token vào cookie\r\n                    VueCookies.set('user', JSON.stringify(res.data));\r\n                    login(res.data);\r\n\r\n                    if (res.data.role == 'ROLE_GIANGVIEN') {\r\n                        router.push('/teacher')\r\n                    } else {\r\n                        router.push('/student')\r\n                    }\r\n                }\r\n\r\n                    try {\r\n                        const u = await getUserByUsername(username.value);\r\n                        if (u) {\r\n                            const studentUsername = u.username;\r\n\r\n                            // Fetch thông tin của học sinh\r\n                            const studentInfo = await authApi().get(endpoints['get-student-by-username'].replace(\"{username}\", studentUsername));\r\n\r\n                            const userEmail = u.email; // Lấy email của người dùng (nếu bạn cần)\r\n\r\n                            // Thực hiện các tác vụ cần thiết (ví dụ: đăng nhập)\r\n                            // Chuyển hướng sau khi đăng nhập thành công\r\n                            if (res.data.role == 'ROLE_GIANGVIEN') {\r\n                                router.push('/teacher/')\r\n                            } else {\r\n                                router.push('/student/')\r\n                            }\r\n                        } else {\r\n                            console.log('User not found');\r\n                            err.value = true;\r\n                        }\r\n                    } catch (err) {\r\n                        err.value = true;\r\n                    }\r\n                } catch (err) {\r\n                    console.error(err);\r\n                    err.value = true;\r\n                }\r\n            };\r\n\r\n            const getUserByUsername = async (username) => {\r\n                try {\r\n                    const response = await Apis.get(endpoints[\"get-user\"].replace(\"{username}\", username));\r\n                    return response.data;\r\n                } catch (error) {\r\n                    console.error(error);\r\n                    return null; // Hoặc xử lý lỗi theo cách bạn muốn\r\n                }\r\n            };\r\n\r\n            return {\r\n                username,\r\n                password,\r\n                err,\r\n                login\r\n            };\r\n        }\r\n    };\r\n</script>\r\n\r\n<style scoped>\r\n    /* CSS cho component của bạn */\r\n</style>"],"mappings":";;;EAGiBA,KAAK,EAAC;AAAW;;;EACFA,KAAK,EAAC;;;EAGjBA,KAAK,EAAC;AAAmB;gEAC1BC,mBAAA,CAA0C;EAAtCD,KAAK,EAAC;AAAiB,GAAC,WAAS;;EAChCA,KAAK,EAAC;AAAiB;gEACxBC,mBAAA,CAAwB,eAAjB,WAAS;;EAIfD,KAAK,EAAC;AAAiB;gEACxBC,mBAAA,CAAuB,eAAhB,UAAQ;gEAInBA,mBAAA,CAEM;EAFDD,KAAK,EAAC;AAAmB,I,aAC1BC,mBAAA,CAAgE;EAAxDC,IAAI,EAAC,QAAQ;EAACF,KAAK,EAAC;GAAkB,WAAS,E;;EAEtDA,KAAK,EAAC;AAAuB;;EACzBA,KAAK,EAAC;AAAiB;;EAGvBA,KAAK,EAAC;AAAe;;;uBAzB9CG,mBAAA,CAgCM,cA/BFF,mBAAA,CA8BO;IA9BAG,QAAM,EAAAC,MAAA,QAAAA,MAAA,MAAAC,cAAA,KAAAC,IAAA,KAAUC,MAAA,CAAAC,KAAA,IAAAD,MAAA,CAAAC,KAAA,IAAAF,IAAA,CAAK;IAAEP,KAAK,EAAC;MAChCC,mBAAA,CA4BM,OA5BNS,UA4BM,GA3BSF,MAAA,CAAAG,GAAG,I,cAAdR,mBAAA,CAEM,OAFNS,UAEM,EAFqC,mEAE3C,K,mCACAX,mBAAA,CAuBM,OAvBNY,UAuBM,GAtBFC,UAA0C,EAC1Cb,mBAAA,CAIM,OAJNc,UAIM,GAHFC,UAAwB,E,gBACxBf,mBAAA,CACmC;IAD5BgB,QAAQ,EAAR,EAAQ;+DAAUT,MAAA,CAAAU,QAAQ,GAAAC,MAAA;IAAEjB,IAAI,EAAC,MAAM;IAACF,KAAK,EAAC,mBAAmB;IACpEoB,WAAW,EAAC;iDADSZ,MAAA,CAAAU,QAAQ,E,KAGrCjB,mBAAA,CAIM,OAJNoB,UAIM,GAHFC,UAAuB,E,gBACvBrB,mBAAA,CACkC;IAD3BgB,QAAQ,EAAR,EAAQ;+DAAUT,MAAA,CAAAe,QAAQ,GAAAJ,MAAA;IAAEjB,IAAI,EAAC,UAAU;IAACF,KAAK,EAAC,mBAAmB;IACxEoB,WAAW,EAAC;iDADSZ,MAAA,CAAAe,QAAQ,E,KAGrCC,UAEM,EACNvB,mBAAA,CAOM,OAPNwB,WAOM,GANFxB,mBAAA,CAEM,OAFNyB,WAEM,G,iBAFuB,QACpB,GAAAC,YAAA,CAA2CC,sBAAA;IAA9BC,EAAE,EAAC;EAAG;sBAAC,MAAS,C,iBAAT,WAAS,E;;QAEtC5B,mBAAA,CAEM,OAFN6B,WAEM,GADFH,YAAA,CAAiDC,sBAAA;IAApCC,EAAE,EAAC;EAAW;sBAAC,MAAO,C,iBAAP,SAAO,E"},"metadata":{},"sourceType":"module","externalDependencies":[]}