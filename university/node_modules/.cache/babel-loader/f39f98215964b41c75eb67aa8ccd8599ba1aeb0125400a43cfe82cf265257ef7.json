{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref } from 'vue';\nimport { useRouter } from 'vue-router';\nimport Apis, { endpoints, authApi } from '../configs/Apis.js';\nimport VueCookies from 'vue-cookies';\nimport { login } from '../reducers/myUseReducer.js';\nimport axios from 'axios';\nexport default {\n  setup() {\n    const username = ref('');\n    const password = ref('');\n    const err = ref(false);\n    const router = useRouter();\n    const token = ref(null);\n    const user = ref(null);\n    let hasLoggedIn = false;\n    const login = async () => {\n      try {\n        let res = await Apis.post(endpoints.login, {\n          username: username.value,\n          password: password.value\n        });\n        console.log(res);\n        // Lưu token vào cookie tại đây nếu cần\n        VueCookies.set('token', res.data);\n        let {\n          data\n        } = await authApi().get(endpoints['current-user']);\n        console.log(\"curent user\", data);\n        // Lưu thông tin người dùng vào cookie tại đây nếu cần\n        // Hàm để lưu token vào cookie\n        VueCookies.set('user', JSON.stringify(res.data));\n        login(res.data);\n        if (res.data.role == 'ROLE_GIANGVIEN') {\n          router.push('/teacher');\n        } else {\n          router.push('/student');\n        }\n        try {\n          const u = await getUserByUsername(username.value);\n          if (u) {\n            const studentUsername = u.username;\n\n            // Fetch thông tin của học sinh\n            const studentInfo = await authApi().get(endpoints['get-student-by-username'].replace(\"{username}\", studentUsername));\n            const userEmail = u.email; // Lấy email của người dùng (nếu bạn cần)\n\n            // Thực hiện các tác vụ cần thiết (ví dụ: đăng nhập)\n            // Chuyển hướng sau khi đăng nhập thành công\n            if (res.data.role == 'ROLE_GIANGVIEN') {\n              router.push('/teacher/');\n            } else {\n              router.push('/student/');\n            }\n          } else {\n            console.log('User not found');\n            err.value = true;\n          }\n        } catch (err) {\n          err.value = true;\n        }\n      } catch (err) {\n        console.error(err);\n        err.value = true;\n      }\n    };\n    const getUserByUsername = async username => {\n      try {\n        const response = await Apis.get(endpoints[\"get-user\"].replace(\"{username}\", username));\n        return response.data;\n      } catch (error) {\n        console.error(error);\n        return null; // Hoặc xử lý lỗi theo cách bạn muốn\n      }\n    };\n\n    return {\n      username,\n      password,\n      err,\n      login\n    };\n  }\n};","map":{"version":3,"names":["ref","useRouter","Apis","endpoints","authApi","VueCookies","login","axios","setup","username","password","err","router","token","user","hasLoggedIn","res","post","value","console","log","set","data","get","JSON","stringify","role","push","u","getUserByUsername","studentUsername","studentInfo","replace","userEmail","email","error","response"],"sources":["D:\\university\\src\\layouts\\login.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <form @submit.prevent=\"login\" class=\"Auth-form-container\">\r\n            <div class=\"Auth-form\">\r\n                <div v-if=\"err\" class=\"alert alert-danger\">\r\n                    Tên người dùng hoặc mật khẩu không chính xác. Vui lòng thử lại.\r\n                </div>\r\n                <div class=\"Auth-form-content\">\r\n                    <h3 class=\"Auth-form-title\">Đăng nhập</h3>\r\n                    <div class=\"form-group mt-3\">\r\n                        <label>Tài khoản</label>\r\n                        <input required v-model=\"username\" type=\"text\" class=\"form-control mt-1\"\r\n                            placeholder=\"Nhập tài khoản\" />\r\n                    </div>\r\n                    <div class=\"form-group mt-3\">\r\n                        <label>Mật khẩu</label>\r\n                        <input required v-model=\"password\" type=\"password\" class=\"form-control mt-1\"\r\n                            placeholder=\"Nhập mật khẩu\" />\r\n                    </div>\r\n                    <div class=\"d-grid gap-2 mt-3\">\r\n                        <button type=\"submit\" class=\"btn btn-primary\">Đăng nhập</button>\r\n                    </div>\r\n                    <div class=\"login text-right mt-2\">\r\n                        <div class=\"forgot-password\">\r\n                            Quên <router-link to=\"#\">mật khẩu?</router-link>\r\n                        </div>\r\n                        <div class=\"register-link\">\r\n                            <router-link to=\"/register\">Đăng ký</router-link>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </form>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import { ref } from 'vue';\r\n    import { useRouter } from 'vue-router';\r\n    import Apis, { endpoints, authApi } from '../configs/Apis.js';\r\n    import VueCookies from 'vue-cookies';\r\n    import { login } from '../reducers/myUseReducer.js';\r\n    import axios from 'axios';\r\n\r\n    export default {\r\n        setup() {\r\n            const username = ref('');\r\n            const password = ref('');\r\n            const err = ref(false);\r\n            const router = useRouter();\r\n            const token = ref(null);\r\n            const user = ref(null);\r\n            let hasLoggedIn = false;\r\n\r\n            const login = async () => {\r\n                try {\r\n                    let res = await Apis.post(endpoints.login, {\r\n                        username: username.value,\r\n                        password: password.value\r\n                    });\r\n                    console.log(res);\r\n                    // Lưu token vào cookie tại đây nếu cần\r\n                    VueCookies.set('token', res.data);\r\n\r\n                    let { data } = await authApi().get(endpoints['current-user']);\r\n                    console.log(\"curent user\", data);\r\n                    // Lưu thông tin người dùng vào cookie tại đây nếu cần\r\n                    // Hàm để lưu token vào cookie\r\n                    VueCookies.set('user', JSON.stringify(res.data));\r\n                    login(res.data);\r\n\r\n                    if (res.data.role == 'ROLE_GIANGVIEN') {\r\n                        router.push('/teacher')\r\n                    } else {\r\n                        router.push('/student')\r\n                    }\r\n\r\n                    try {\r\n                        const u = await getUserByUsername(username.value);\r\n                        if (u) {\r\n                            const studentUsername = u.username;\r\n\r\n                            // Fetch thông tin của học sinh\r\n                            const studentInfo = await authApi().get(endpoints['get-student-by-username'].replace(\"{username}\", studentUsername));\r\n\r\n                            const userEmail = u.email; // Lấy email của người dùng (nếu bạn cần)\r\n\r\n                            // Thực hiện các tác vụ cần thiết (ví dụ: đăng nhập)\r\n                            // Chuyển hướng sau khi đăng nhập thành công\r\n                            if (res.data.role == 'ROLE_GIANGVIEN') {\r\n                                router.push('/teacher/')\r\n                            } else {\r\n                                router.push('/student/')\r\n                            }\r\n                        } else {\r\n                            console.log('User not found');\r\n                            err.value = true;\r\n                        }\r\n                    } catch (err) {\r\n                        err.value = true;\r\n                    }\r\n                } catch (err) {\r\n                    console.error(err);\r\n                    err.value = true;\r\n                }\r\n            };\r\n\r\n            const getUserByUsername = async (username) => {\r\n                try {\r\n                    const response = await Apis.get(endpoints[\"get-user\"].replace(\"{username}\", username));\r\n                    return response.data;\r\n                } catch (error) {\r\n                    console.error(error);\r\n                    return null; // Hoặc xử lý lỗi theo cách bạn muốn\r\n                }\r\n            };\r\n\r\n            return {\r\n                username,\r\n                password,\r\n                err,\r\n                login\r\n            };\r\n        }\r\n    };\r\n</script>\r\n\r\n<style scoped>\r\n    /* CSS cho component của bạn */\r\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}