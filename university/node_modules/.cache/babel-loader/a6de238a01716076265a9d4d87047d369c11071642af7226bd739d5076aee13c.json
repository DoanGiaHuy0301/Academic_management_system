{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref } from 'vue';\nimport { useRouter } from 'vue-router';\nimport Apis, { endpoints, authApi } from '../configs/Apis.js';\nimport VueCookies from 'vue-cookies';\nimport { mapState } from \"vuex\";\nexport default {\n  name: \"Login\",\n  computed: {\n    ...mapState([\"store\"])\n  },\n  data() {\n    return {\n      user: {\n        username: \"\",\n        password: \"\"\n      },\n      errorMessage: \"\"\n    };\n  },\n  methods: {\n    async login() {\n      try {\n        const res = await Apis.post(`${endpoints[\"login\"]}`, {\n          username: this.user.username,\n          password: this.user.password\n        });\n        if (res.data === \"error\") {\n          this.errorMessage = \"Tài khoản hoặc mật khẩu của bạn không đúng!!\";\n        } else {\n          console.log(res.data);\n          this.errorMessage = \"\";\n          VueCookies.set(\"token\", res.data);\n          let {\n            data\n          } = await authApi().get(endpoints[\"current-user\"]);\n          VueCookies.set(\"user\", data);\n          console.log(data);\n          await this.$store.dispatch(\"login\", data);\n          if (data.role == 'ROLE_GIANGVIEN') {\n            this.$router.push('/teacher');\n          } else if (data.role == 'ROLE_SINHVIEN') {\n            this.$router.push('/student');\n          }\n        }\n      } catch (error) {\n        throw error;\n      }\n    }\n  },\n  watch: {\n    \"errorMessage\": function (newErrorMessage, oldErrorMessage) {\n      console.log(`Giá trị mới của user.errorMessage: ${newErrorMessage}`);\n      console.log(`Giá trị cũ của user.errorMessage: ${oldErrorMessage}`);\n\n      // Thực hiện các hành động khác tại đây nếu cần\n    }\n  }\n};","map":{"version":3,"names":["ref","useRouter","Apis","endpoints","authApi","VueCookies","mapState","name","computed","data","user","username","password","errorMessage","methods","login","res","post","console","log","set","get","$store","dispatch","role","$router","push","error","watch","newErrorMessage","oldErrorMessage"],"sources":["D:\\university\\src\\layouts\\login.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <form @submit.prevent=\"login\" class=\"Auth-form-container\">\r\n            <div class=\"Auth-form\">\r\n                <div v-if=\"err\" class=\"alert alert-danger\">\r\n                    Tên người dùng hoặc mật khẩu không chính xác. Vui lòng thử lại.\r\n                </div>\r\n                <div class=\"Auth-form-content\">\r\n                    <h3 class=\"Auth-form-title\">Đăng nhập</h3>\r\n                    <div class=\"form-group mt-3\">\r\n                        <label>Tài khoản</label>\r\n                        <input required v-model=\"user.username\" id=\"username\" type=\"text\" class=\"form-control mt-1\"\r\n                            placeholder=\"Nhập tài khoản\" />\r\n                    </div>\r\n                    <div class=\"form-group mt-3\">\r\n                        <label>Mật khẩu</label>\r\n                        <input required v-model=\"user.password\" id=\"password\" type=\"password\" class=\"form-control mt-1\"\r\n                            placeholder=\"Nhập mật khẩu\" />\r\n                    </div>\r\n                    <div class=\"d-grid gap-2 mt-3\">\r\n                        <button type=\"submit\" class=\"btn btn-primary\">Đăng nhập</button>\r\n                    </div>\r\n                    <div class=\"login text-right mt-2\">\r\n                        <div class=\"forgot-password\">\r\n                            Quên <router-link to=\"#\">mật khẩu?</router-link>\r\n                        </div>\r\n                        <div class=\"register-link\">\r\n                            <router-link to=\"/register\">Đăng ký</router-link>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </form>\r\n    </div>\r\n</template>\r\n\r\n\r\n<script>\r\n    import { ref } from 'vue';\r\n    import { useRouter } from 'vue-router';\r\n    import Apis, { endpoints, authApi } from '../configs/Apis.js';\r\n    import VueCookies from 'vue-cookies';\r\n    import { mapState } from \"vuex\";\r\n\r\n    export default {\r\n        name: \"Login\",\r\n        computed: {\r\n            ...mapState([\"store\"]),\r\n        },\r\n        data() {\r\n            return {\r\n                user: {\r\n                    username: \"\",\r\n                    password: \"\",\r\n                },\r\n                errorMessage: \"\",\r\n            };\r\n        },\r\n        methods: {\r\n            async login() {\r\n                try {\r\n                    const res = await Apis.post(`${endpoints[\"login\"]}`, {\r\n                        username: this.user.username,\r\n                        password: this.user.password,\r\n                    });\r\n                    if (res.data === \"error\") {\r\n                        this.errorMessage =\r\n                            \"Tài khoản hoặc mật khẩu của bạn không đúng!!\";\r\n                    } else {\r\n                        console.log(res.data);\r\n                        this.errorMessage = \"\";\r\n                        VueCookies.set(\"token\", res.data);\r\n\r\n                        let { data } = await authApi().get(endpoints[\"current-user\"]);\r\n                        VueCookies.set(\"user\", data);\r\n                        console.log(data);\r\n\r\n                        await this.$store.dispatch(\"login\", data);\r\n\r\n                        if (data.role == 'ROLE_GIANGVIEN') {\r\n                            this.$router.push('/teacher');\r\n                        }\r\n                        else if (data.role == 'ROLE_SINHVIEN') {\r\n                            this.$router.push('/student');\r\n                        }\r\n                    }\r\n                } catch (error) {\r\n                    throw error;\r\n                }\r\n            },\r\n        },\r\n        watch: {\r\n            \"errorMessage\": function (newErrorMessage, oldErrorMessage) {\r\n                console.log(`Giá trị mới của user.errorMessage: ${newErrorMessage}`);\r\n                console.log(`Giá trị cũ của user.errorMessage: ${oldErrorMessage}`);\r\n\r\n                // Thực hiện các hành động khác tại đây nếu cần\r\n            },\r\n        },\r\n    };\r\n\r\n</script>\r\n\r\n<!-- <script>\r\n    import { ref } from 'vue';\r\n    import { useRouter } from 'vue-router';\r\n    import Apis, { endpoints, authApi } from '../configs/Apis.js';\r\n    import VueCookies from 'vue-cookies';\r\n    import { login } from '../reducers/myUseReducer.js';\r\n    import axios from 'axios';\r\n\r\n    export default {\r\n        setup() {\r\n            const username = ref('');\r\n            const password = ref('');\r\n            const err = ref(false);\r\n            const router = useRouter();\r\n            const token = ref(null);\r\n            const user = ref(null);\r\n\r\n            const login = async () => {\r\n                try {\r\n                    let res = await Apis.post(endpoints.login, {\r\n                        username: username.value,\r\n                        password: password.value\r\n                    });\r\n                    console.log(res);\r\n                    // Lưu token vào cookie tại đây nếu cần\r\n                    VueCookies.set('token', res.data);\r\n\r\n                    let { data } = await authApi().get(endpoints['current-user']);\r\n                    console.log(\"curent user\", data);\r\n                    // Lưu thông tin người dùng vào cookie tại đây nếu cần\r\n                    // Hàm để lưu token vào cookie\r\n                    VueCookies.set('user', JSON.stringify(res.data));\r\n                    login(res.data);\r\n\r\n                    if (res.data.role == 'ROLE_GIANGVIEN') {\r\n                        router.push('/teacher')\r\n                    } else {\r\n                        router.push('/student')\r\n                    }\r\n\r\n                    try {\r\n                        const u = await getUserByUsername(username.value);\r\n                        if (u) {\r\n                            const studentUsername = u.username;\r\n\r\n                            // Fetch thông tin của học sinh\r\n                            const studentInfo = await authApi().get(endpoints['get-student-by-username'].replace(\"{username}\", studentUsername));\r\n\r\n                            const userEmail = u.email; // Lấy email của người dùng (nếu bạn cần)\r\n\r\n                            // Thực hiện các tác vụ cần thiết (ví dụ: đăng nhập)\r\n                            // Chuyển hướng sau khi đăng nhập thành công\r\n                            if (res.data.role == 'ROLE_GIANGVIEN') {\r\n                                router.push('/teacher')\r\n                            } else {\r\n                                router.push('/student')\r\n                            }\r\n                        } else {\r\n                            console.log('User not found');\r\n                            err.value = true;\r\n                        }\r\n                    } catch (err) {\r\n                        err.value = true;\r\n                    }\r\n                } catch (err) {\r\n                    console.error(err);\r\n                    err.value = true;\r\n                }\r\n            };\r\n\r\n            const getUserByUsername = async (username) => {\r\n                try {\r\n                    const response = await Apis.get(endpoints[\"get-user\"].replace(\"{username}\", username));\r\n                    return response.data;\r\n                } catch (error) {\r\n                    console.error(error);\r\n                    return null; // Hoặc xử lý lỗi theo cách bạn muốn\r\n                }\r\n            };\r\n\r\n            return {\r\n                username,\r\n                password,\r\n                err,\r\n                login\r\n            };\r\n        }\r\n    };\r\n</script>  -->\r\n\r\n<style scoped>\r\n    /* CSS cho component của bạn */\r\n</style>"],"mappings":";AAsCI,SAASA,GAAE,QAAS,KAAK;AACzB,SAASC,SAAQ,QAAS,YAAY;AACtC,OAAOC,IAAI,IAAIC,SAAS,EAAEC,OAAM,QAAS,oBAAoB;AAC7D,OAAOC,UAAS,MAAO,aAAa;AACpC,SAASC,QAAO,QAAS,MAAM;AAE/B,eAAe;EACXC,IAAI,EAAE,OAAO;EACbC,QAAQ,EAAE;IACN,GAAGF,QAAQ,CAAC,CAAC,OAAO,CAAC;EACzB,CAAC;EACDG,IAAIA,CAAA,EAAG;IACH,OAAO;MACHC,IAAI,EAAE;QACFC,QAAQ,EAAE,EAAE;QACZC,QAAQ,EAAE;MACd,CAAC;MACDC,YAAY,EAAE;IAClB,CAAC;EACL,CAAC;EACDC,OAAO,EAAE;IACL,MAAMC,KAAKA,CAAA,EAAG;MACV,IAAI;QACA,MAAMC,GAAE,GAAI,MAAMd,IAAI,CAACe,IAAI,CAAE,GAAEd,SAAS,CAAC,OAAO,CAAE,EAAC,EAAE;UACjDQ,QAAQ,EAAE,IAAI,CAACD,IAAI,CAACC,QAAQ;UAC5BC,QAAQ,EAAE,IAAI,CAACF,IAAI,CAACE;QACxB,CAAC,CAAC;QACF,IAAII,GAAG,CAACP,IAAG,KAAM,OAAO,EAAE;UACtB,IAAI,CAACI,YAAW,GACZ,8CAA8C;QACtD,OAAO;UACHK,OAAO,CAACC,GAAG,CAACH,GAAG,CAACP,IAAI,CAAC;UACrB,IAAI,CAACI,YAAW,GAAI,EAAE;UACtBR,UAAU,CAACe,GAAG,CAAC,OAAO,EAAEJ,GAAG,CAACP,IAAI,CAAC;UAEjC,IAAI;YAAEA;UAAK,IAAI,MAAML,OAAO,CAAC,CAAC,CAACiB,GAAG,CAAClB,SAAS,CAAC,cAAc,CAAC,CAAC;UAC7DE,UAAU,CAACe,GAAG,CAAC,MAAM,EAAEX,IAAI,CAAC;UAC5BS,OAAO,CAACC,GAAG,CAACV,IAAI,CAAC;UAEjB,MAAM,IAAI,CAACa,MAAM,CAACC,QAAQ,CAAC,OAAO,EAAEd,IAAI,CAAC;UAEzC,IAAIA,IAAI,CAACe,IAAG,IAAK,gBAAgB,EAAE;YAC/B,IAAI,CAACC,OAAO,CAACC,IAAI,CAAC,UAAU,CAAC;UACjC,OACK,IAAIjB,IAAI,CAACe,IAAG,IAAK,eAAe,EAAE;YACnC,IAAI,CAACC,OAAO,CAACC,IAAI,CAAC,UAAU,CAAC;UACjC;QACJ;MACJ,EAAE,OAAOC,KAAK,EAAE;QACZ,MAAMA,KAAK;MACf;IACJ;EACJ,CAAC;EACDC,KAAK,EAAE;IACH,cAAc,EAAE,SAAAf,CAAUgB,eAAe,EAAEC,eAAe,EAAE;MACxDZ,OAAO,CAACC,GAAG,CAAE,sCAAqCU,eAAgB,EAAC,CAAC;MACpEX,OAAO,CAACC,GAAG,CAAE,qCAAoCW,eAAgB,EAAC,CAAC;;MAEnE;IACJ;EACJ;AACJ,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}