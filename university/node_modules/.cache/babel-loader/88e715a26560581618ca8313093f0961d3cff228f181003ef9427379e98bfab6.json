{"ast":null,"code":"import Apis from '../configs/Apis.js';","map":{"version":3,"names":["Apis"],"sources":["D:\\university\\src\\layouts\\login.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <form @submit.prevent=\"login\" class=\"Auth-form-container\">\r\n            <div class=\"Auth-form\">\r\n                <div v-if=\"err\" class=\"alert alert-danger\">\r\n                    Tên người dùng hoặc mật khẩu không chính xác. Vui lòng thử lại.\r\n                </div>\r\n                <div class=\"Auth-form-content\">\r\n                    <h3 class=\"Auth-form-title\">Đăng nhập</h3>\r\n                    <div class=\"form-group mt-3\">\r\n                        <label>Tài khoản</label>\r\n                        <input required v-model=\"username\" type=\"text\" class=\"form-control mt-1\"\r\n                            placeholder=\"Nhập tài khoản\" />\r\n                    </div>\r\n                    <div class=\"form-group mt-3\">\r\n                        <label>Mật khẩu</label>\r\n                        <input required v-model=\"password\" type=\"password\" class=\"form-control mt-1\"\r\n                            placeholder=\"Nhập mật khẩu\" />\r\n                    </div>\r\n                    <div class=\"d-grid gap-2 mt-3\">\r\n                        <button type=\"submit\" class=\"btn btn-primary\">Đăng nhập</button>\r\n                    </div>\r\n                    <div class=\"login text-right mt-2\">\r\n                        <div class=\"forgot-password\">\r\n                            Quên <router-link to=\"#\">mật khẩu?</router-link>\r\n                        </div>\r\n                        <div class=\"register-link\">\r\n                            <router-link to=\"/register\">Đăng ký</router-link>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </form>\r\n    </div>\r\n</template>\r\n\r\n\r\n<script>\r\n    import Apis from '../configs/Apis.js';\r\n    \r\n</script>\r\n\r\n<!-- <script>\r\n    import { ref } from 'vue';\r\n    import { useRouter } from 'vue-router';\r\n    import Apis, { endpoints, authApi } from '../configs/Apis.js';\r\n    import VueCookies from 'vue-cookies';\r\n    import { login } from '../reducers/myUseReducer.js';\r\n    import axios from 'axios';\r\n\r\n    export default {\r\n        setup() {\r\n            const username = ref('');\r\n            const password = ref('');\r\n            const err = ref(false);\r\n            const router = useRouter();\r\n            const token = ref(null);\r\n            const user = ref(null);\r\n\r\n            const login = async () => {\r\n                try {\r\n                    let res = await Apis.post(endpoints.login, {\r\n                        username: username.value,\r\n                        password: password.value\r\n                    });\r\n                    console.log(res);\r\n                    // Lưu token vào cookie tại đây nếu cần\r\n                    VueCookies.set('token', res.data);\r\n\r\n                    let { data } = await authApi().get(endpoints['current-user']);\r\n                    console.log(\"curent user\", data);\r\n                    // Lưu thông tin người dùng vào cookie tại đây nếu cần\r\n                    // Hàm để lưu token vào cookie\r\n                    VueCookies.set('user', JSON.stringify(res.data));\r\n                    login(res.data);\r\n\r\n                    if (res.data.role == 'ROLE_GIANGVIEN') {\r\n                        router.push('/teacher')\r\n                    } else {\r\n                        router.push('/student')\r\n                    }\r\n\r\n                    try {\r\n                        const u = await getUserByUsername(username.value);\r\n                        if (u) {\r\n                            const studentUsername = u.username;\r\n\r\n                            // Fetch thông tin của học sinh\r\n                            const studentInfo = await authApi().get(endpoints['get-student-by-username'].replace(\"{username}\", studentUsername));\r\n\r\n                            const userEmail = u.email; // Lấy email của người dùng (nếu bạn cần)\r\n\r\n                            // Thực hiện các tác vụ cần thiết (ví dụ: đăng nhập)\r\n                            // Chuyển hướng sau khi đăng nhập thành công\r\n                            if (res.data.role == 'ROLE_GIANGVIEN') {\r\n                                router.push('/teacher')\r\n                            } else {\r\n                                router.push('/student')\r\n                            }\r\n                        } else {\r\n                            console.log('User not found');\r\n                            err.value = true;\r\n                        }\r\n                    } catch (err) {\r\n                        err.value = true;\r\n                    }\r\n                } catch (err) {\r\n                    console.error(err);\r\n                    err.value = true;\r\n                }\r\n            };\r\n\r\n            const getUserByUsername = async (username) => {\r\n                try {\r\n                    const response = await Apis.get(endpoints[\"get-user\"].replace(\"{username}\", username));\r\n                    return response.data;\r\n                } catch (error) {\r\n                    console.error(error);\r\n                    return null; // Hoặc xử lý lỗi theo cách bạn muốn\r\n                }\r\n            };\r\n\r\n            return {\r\n                username,\r\n                password,\r\n                err,\r\n                login\r\n            };\r\n        }\r\n    };\r\n</script>  -->\r\n\r\n<style scoped>\r\n    /* CSS cho component của bạn */\r\n</style>"],"mappings":"AAsCI,OAAOA,IAAG,MAAO,oBAAoB"},"metadata":{},"sourceType":"module","externalDependencies":[]}