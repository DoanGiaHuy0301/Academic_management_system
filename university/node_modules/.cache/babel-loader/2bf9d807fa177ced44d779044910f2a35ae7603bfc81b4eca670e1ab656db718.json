{"ast":null,"code":"import { ref } from 'vue';\nimport { useNavigate } from 'vue-router';\nimport Apis, { authApi, endpoints } from '../co';\nimport { auth } from \"../../firebase\";\nimport { signInWithEmailAndPassword } from \"firebase/auth\";\nimport cookie from \"vue-cookies\";\nexport default {\n  setup() {\n    const username = ref('');\n    const password = ref('');\n    const err = ref(false);\n    const navigate = useNavigate();\n    const login = async evt => {\n      evt.preventDefault();\n      const process = async () => {\n        try {\n          let res = await Apis.post(endpoints['login'], {\n            \"username\": username.value,\n            \"password\": password.value\n          });\n          cookie.set(\"token\", res.data);\n          let {\n            data\n          } = await authApi().get(endpoints['current-user']);\n          cookie.set(\"user\", data);\n\n          // dispatch({\n          //   \"type\": \"login\",\n          //   \"payload\": data\n          // });\n\n          try {\n            const u = await getUserByUsername(username.value);\n            if (u) {\n              const studentUsername = u.username;\n\n              // Fetch student information\n              const studentInfo = await authApi().get(endpoints['get-student-by-username'].replace(\"{username}\", studentUsername));\n              const userEmail = u.email; // Lấy email của người dùng\n              await signInWithEmailAndPassword(auth, userEmail, password.value);\n              navigate(\"/\");\n            } else {\n              console.log('User not found');\n              err.value = true;\n            }\n          } catch (err) {\n            err.value = true;\n          }\n        } catch (err) {\n          console.error(err);\n          err.value = true;\n        }\n      };\n      process();\n    };\n    const getUserByUsername = async username => {\n      try {\n        const response = await Apis.get(endpoints[\"get-user\"].replace(\"{username}\", username));\n        return response.data;\n      } catch (error) {\n        console.error(error);\n        return null;\n      }\n    };\n    return {\n      username,\n      password,\n      err,\n      login\n    };\n  }\n};","map":{"version":3,"names":["ref","useNavigate","Apis","authApi","endpoints","auth","signInWithEmailAndPassword","cookie","setup","username","password","err","navigate","login","evt","preventDefault","process","res","post","value","set","data","get","u","getUserByUsername","studentUsername","studentInfo","replace","userEmail","email","console","log","error","response"],"sources":["D:\\university\\src\\layouts\\login.vue"],"sourcesContent":["<template>\r\n  <div class=\"login-container\">\r\n    <form @submit=\"login\" class=\"Auth-form-container\">\r\n      <div class=\"Auth-form\">\r\n        <template v-if=\"err\">\r\n          <div class=\"alert alert-danger\" role=\"alert\">\r\n            Tên người dùng hoặc mật khẩu không chính xác. Vui lòng thử lại.\r\n          </div>\r\n        </template>\r\n        <div class=\"Auth-form-content\">\r\n          <h3 class=\"Auth-form-title\">Đăng nhập</h3>\r\n          <div class=\"form-group mt-3\">\r\n            <label>Tài khoản</label>\r\n            <input\r\n              v-model=\"username\"\r\n              required\r\n              type=\"text\"\r\n              class=\"form-control mt-1\"\r\n              placeholder=\"Nhập tài khoản\"\r\n            />\r\n          </div>\r\n          <div class=\"form-group mt-3\">\r\n            <label>Mật khẩu</label>\r\n            <input\r\n              v-model=\"password\"\r\n              required\r\n              type=\"password\"\r\n              class=\"form-control mt-1\"\r\n              placeholder=\"Nhập mật khẩu\"\r\n            />\r\n          </div>\r\n          <div class=\"d-grid gap-2 mt-3\">\r\n            <button type=\"submit\" class=\"btn btn-primary\">Đăng nhập</button>\r\n          </div>\r\n          <template v-if=\"err\">\r\n            <span>Something went wrong</span>\r\n          </template>\r\n          <div class=\"login text-right mt-2\">\r\n            <div class=\"forgot-password\">\r\n              Quên <router-link to=\"#\">mật khẩu?</router-link>\r\n            </div>\r\n            <div class=\"register-link\">\r\n              <router-link to=\"/register\">Đăng ký</router-link>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref } from 'vue';\r\nimport { useNavigate } from 'vue-router';\r\nimport Apis, { authApi, endpoints } from '../co';\r\nimport { auth } from \"../../firebase\";\r\nimport { signInWithEmailAndPassword } from \"firebase/auth\";\r\nimport cookie from \"vue-cookies\";\r\n\r\nexport default {\r\n  setup() {\r\n    const username = ref('');\r\n    const password = ref('');\r\n    const err = ref(false);\r\n    const navigate = useNavigate();\r\n\r\n    const login = async (evt) => {\r\n      evt.preventDefault();\r\n\r\n      const process = async () => {\r\n        try {\r\n          let res = await Apis.post(endpoints['login'], {\r\n            \"username\": username.value,\r\n            \"password\": password.value\r\n          });\r\n          cookie.set(\"token\", res.data);\r\n\r\n          let { data } = await authApi().get(endpoints['current-user']);\r\n          cookie.set(\"user\", data);\r\n\r\n          // dispatch({\r\n          //   \"type\": \"login\",\r\n          //   \"payload\": data\r\n          // });\r\n\r\n          try {\r\n            const u = await getUserByUsername(username.value);\r\n            if (u) {\r\n              const studentUsername = u.username;\r\n\r\n              // Fetch student information\r\n              const studentInfo = await authApi().get(endpoints['get-student-by-username'].replace(\"{username}\", studentUsername));\r\n\r\n              const userEmail = u.email; // Lấy email của người dùng\r\n              await signInWithEmailAndPassword(auth, userEmail, password.value);\r\n              navigate(\"/\")\r\n            } else {\r\n              console.log('User not found');\r\n              err.value = true;\r\n            }\r\n\r\n          } catch (err) {\r\n            err.value = true;\r\n          }\r\n        } catch (err) {\r\n          console.error(err);\r\n          err.value = true;\r\n        }\r\n      }\r\n\r\n      process();\r\n    }\r\n\r\n    const getUserByUsername = async (username) => {\r\n      try {\r\n        const response = await Apis.get(endpoints[\"get-user\"].replace(\"{username}\", username));\r\n        return response.data;\r\n      } catch (error) {\r\n        console.error(error);\r\n        return null;\r\n      }\r\n    }\r\n\r\n    return {\r\n      username,\r\n      password,\r\n      err,\r\n      login\r\n    };\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n/* Thêm CSS của bạn tại đây */\r\n</style>\r\n"],"mappings":"AAoDA,SAASA,GAAE,QAAS,KAAK;AACzB,SAASC,WAAU,QAAS,YAAY;AACxC,OAAOC,IAAI,IAAIC,OAAO,EAAEC,SAAQ,QAAS,OAAO;AAChD,SAASC,IAAG,QAAS,gBAAgB;AACrC,SAASC,0BAAyB,QAAS,eAAe;AAC1D,OAAOC,MAAK,MAAO,aAAa;AAEhC,eAAe;EACbC,KAAKA,CAAA,EAAG;IACN,MAAMC,QAAO,GAAIT,GAAG,CAAC,EAAE,CAAC;IACxB,MAAMU,QAAO,GAAIV,GAAG,CAAC,EAAE,CAAC;IACxB,MAAMW,GAAE,GAAIX,GAAG,CAAC,KAAK,CAAC;IACtB,MAAMY,QAAO,GAAIX,WAAW,CAAC,CAAC;IAE9B,MAAMY,KAAI,GAAI,MAAOC,GAAG,IAAK;MAC3BA,GAAG,CAACC,cAAc,CAAC,CAAC;MAEpB,MAAMC,OAAM,GAAI,MAAAA,CAAA,KAAY;QAC1B,IAAI;UACF,IAAIC,GAAE,GAAI,MAAMf,IAAI,CAACgB,IAAI,CAACd,SAAS,CAAC,OAAO,CAAC,EAAE;YAC5C,UAAU,EAAEK,QAAQ,CAACU,KAAK;YAC1B,UAAU,EAAET,QAAQ,CAACS;UACvB,CAAC,CAAC;UACFZ,MAAM,CAACa,GAAG,CAAC,OAAO,EAAEH,GAAG,CAACI,IAAI,CAAC;UAE7B,IAAI;YAAEA;UAAK,IAAI,MAAMlB,OAAO,CAAC,CAAC,CAACmB,GAAG,CAAClB,SAAS,CAAC,cAAc,CAAC,CAAC;UAC7DG,MAAM,CAACa,GAAG,CAAC,MAAM,EAAEC,IAAI,CAAC;;UAExB;UACA;UACA;UACA;;UAEA,IAAI;YACF,MAAME,CAAA,GAAI,MAAMC,iBAAiB,CAACf,QAAQ,CAACU,KAAK,CAAC;YACjD,IAAII,CAAC,EAAE;cACL,MAAME,eAAc,GAAIF,CAAC,CAACd,QAAQ;;cAElC;cACA,MAAMiB,WAAU,GAAI,MAAMvB,OAAO,CAAC,CAAC,CAACmB,GAAG,CAAClB,SAAS,CAAC,yBAAyB,CAAC,CAACuB,OAAO,CAAC,YAAY,EAAEF,eAAe,CAAC,CAAC;cAEpH,MAAMG,SAAQ,GAAIL,CAAC,CAACM,KAAK,EAAE;cAC3B,MAAMvB,0BAA0B,CAACD,IAAI,EAAEuB,SAAS,EAAElB,QAAQ,CAACS,KAAK,CAAC;cACjEP,QAAQ,CAAC,GAAG;YACd,OAAO;cACLkB,OAAO,CAACC,GAAG,CAAC,gBAAgB,CAAC;cAC7BpB,GAAG,CAACQ,KAAI,GAAI,IAAI;YAClB;UAEF,EAAE,OAAOR,GAAG,EAAE;YACZA,GAAG,CAACQ,KAAI,GAAI,IAAI;UAClB;QACF,EAAE,OAAOR,GAAG,EAAE;UACZmB,OAAO,CAACE,KAAK,CAACrB,GAAG,CAAC;UAClBA,GAAG,CAACQ,KAAI,GAAI,IAAI;QAClB;MACF;MAEAH,OAAO,CAAC,CAAC;IACX;IAEA,MAAMQ,iBAAgB,GAAI,MAAOf,QAAQ,IAAK;MAC5C,IAAI;QACF,MAAMwB,QAAO,GAAI,MAAM/B,IAAI,CAACoB,GAAG,CAAClB,SAAS,CAAC,UAAU,CAAC,CAACuB,OAAO,CAAC,YAAY,EAAElB,QAAQ,CAAC,CAAC;QACtF,OAAOwB,QAAQ,CAACZ,IAAI;MACtB,EAAE,OAAOW,KAAK,EAAE;QACdF,OAAO,CAACE,KAAK,CAACA,KAAK,CAAC;QACpB,OAAO,IAAI;MACb;IACF;IAEA,OAAO;MACLvB,QAAQ;MACRC,QAAQ;MACRC,GAAG;MACHE;IACF,CAAC;EACH;AACF"},"metadata":{},"sourceType":"module","externalDependencies":[]}